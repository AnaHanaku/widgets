let userConfig = [
    {
        emote: "RaccAttack",
        amount: 1,
        soundFile: "https://cdn.streamelements.com/uploads/dfc73433-d771-4b95-b9a4-a67593cd21ba.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 10, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "ricardoFlick",
        amount: 1,
        soundFile: "https://cdn.streamelements.com/uploads/9a7c1c15-6ba5-4c6b-93aa-b08df448a6f2.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 10, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "greekSleeper",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/4b044185-0cb2-4a88-9d9b-920c9dfca653.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "EZ",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/592473a5-c892-4a01-89c9-25bec8a7aa14.mp3",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    /*      	{
    emote:"4Head",
                amount: 2,
                soundFile: "https://cdn.streamelements.com/uploads/c2234f91-72cf-469a-bcc5-1b05bdd9eec0.ogg",
                imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
                volume: 50,
                timeout: 3, //seconds
                cooldown: 240, //seconds
            }, */
    {
        emote: "WeebsOut",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/84948516-f249-433e-b6b1-5778135a2a42.mp3",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "OMEGALUL",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/41fdf10e-73fc-4925-a5c6-1848b5228d68.mp3",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "ZULUL",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/0f8a6667-0b33-44e6-92be-175d06b9d55a.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "peepoBlanket",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/12fbc314-1b85-4f82-b1d4-d17f092ec2a5.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "peepoHappy",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/0e7f1bf5-bdc7-4ae2-ae5b-32d58b1394e4.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "peepoJAM",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/82f20dfd-1fc9-4bbb-ae04-0beaa0d411ed.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "POGGERS",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/b2cf871e-ef1e-4222-99fc-229d8d23718c.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "greekLouder",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/ab2c86f6-3ae5-496a-afe8-1f1168fe08d9.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "NaM",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/1b29f9f8-f287-4686-8356-5212330f80d2.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "KKomrade",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/8cd54d75-767a-4bf0-bcc6-0ab0a1a46053.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "monkaW",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/b9e573f7-9f74-42d6-9733-3a16b2d73ce0.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "PepeLaugh",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/6f8eda5d-9add-433b-babb-742453c38199.mp3",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "forsenBee",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/f0e2bc42-d10d-4765-83c8-75a1d85ffe0e.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 20,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "greekCall",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/05e8be4b-00ce-4f5a-bb60-746b0e4b30de.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "OhMyDog",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/9725f21f-7547-4b3f-bf33-649876fea579.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "forsenCD",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/1db194cb-8021-4aa7-ad0a-b5c4bf5522a3.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "Gnomed",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/b7feaece-ab5b-49c0-868d-15170d30cca2.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "PepeHands",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/0e784440-41fc-4d58-83e4-7f2c9f295856.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "D:",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/85eb14ff-30da-4813-beb0-d06ea3b1dcca.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "Dance",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/9e3de351-5945-4316-ac3a-2760c14e3b1c.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "AYAYA",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/1f53291c-ab61-4b35-92eb-fb6a4948b2a7.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    {
        emote: "greekBruh",
        amount: 2,
        soundFile: "https://cdn.streamelements.com/uploads/8cf607f1-b145-4cdb-84dd-678d8bb2f0c0.ogg",
        imageFile: "https://cdn.streamelements.com/uploads/ee48a3bb-bb7c-4e32-a799-3aaa19e777b1.gif",
        volume: 50,
        timeout: 3, //seconds
        cooldown: 240, //seconds
    },
    /*      	{
                emote:"",
                amount: 2,
                soundFile: "",
                volume: 50,
                timeout: 3, //seconds
                cooldown: 240, //seconds
            },
              */
];


let queue = $("#placeholder");
let emoticons = [];
window.addEventListener('onEventReceived', function (obj) {
    if (obj.detail.listener !== "message") return;
    let data = obj.detail.event.data;
    let message = data["text"];
    let words = message.split(" ");
    let results = words.filter(value => -1 !== emoticons.indexOf(value));
    results = Array.from(new Set(results)); //getting unique emoticons
    for (let i in results) {
        index = userConfig.findIndex(x => x.emote === results[i]);
        if (index !== -1) {
            checkPlay(index);
        }
    }

});

function checkPlay(index) {
    let sound = userConfig[index];


    if (sound.cooldownEnd < Date.now() / 1000) {
        userConfig[index]['counter']++;
        if (userConfig[index]['timer'] === 0) {
            userConfig[index]['timer'] = userConfig[index]['timeout'];
        }
        if (userConfig[index]['counter'] >= userConfig[index]['amount']) {
            userConfig[index]['cooldownEnd'] = (Date.now() / 1000) + sound.cooldown;
            let tmpaudio = new Audio(sound.soundFile);
            tmpaudio.onloadeddata = function () {
                console.log(`adding ${index} to queue after ${tmpaudio.duration}`);

                queue
                    .queue(function () {
                        let audio = new Audio(sound.soundFile);
                        audio.volume = sound.volume * .01;
                        audio.play();
                        if (sound.imageFile.length > 10) {
                            $("#image").css('background-image', 'url(' + sound.imageFile + ')');
                            setTimeout(function () {
                                $("#image").css('background-image', '');
                            }, tmpaudio.duration * 1000);
                        }
                        $(this).delay(tmpaudio.duration * 1000);
                        $(this).dequeue();
                    });


            };

        }
    }
}

for (let key in userConfig) {
    emoticons.push(userConfig[key]["emote"]);
    userConfig[key]['counter'] = 0;
    userConfig[key]['cooldownEnd'] = 0;
    userConfig[key]['timer'] = 0;
}

let t = setInterval(function () {
    for (let key in userConfig) {
        userConfig[key]['timer'] = Math.max((userConfig[key]['timer'] - 1), 0);
        if (userConfig[key]['timer'] === 0) {
            userConfig[key]['counter'] = 0;
        }
    }
}, 1000);
